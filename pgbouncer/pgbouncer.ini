[databases]
; Database connections
; Format: dbname = host=hostname port=port dbname=database
arena_db = host=${DB_HOST} port=${DB_PORT} dbname=${DB_NAME}

[pgbouncer]
; Connection pooling mode
; - session: Server connection released when client disconnects (default)
; - transaction: Server connection released after transaction finishes (recommended)
; - statement: Server connection released after each statement (not recommended)
pool_mode = transaction

; Listen on all interfaces
listen_addr = 0.0.0.0
listen_port = 6432

; Authentication
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

; Administrator users
admin_users = ${DB_USER}

; Connection limits
; max_client_conn: Maximum number of client connections
; default_pool_size: How many server connections to allow per database
; reserve_pool_size: How many additional connections to allow in reserve
; max_db_connections: Do not allow more than this many connections per database

max_client_conn = 1000
default_pool_size = 25
reserve_pool_size = 5
max_db_connections = 50
max_user_connections = 50

; Connection timeouts (in seconds)
server_idle_timeout = 600
server_lifetime = 3600
server_connect_timeout = 15
query_timeout = 30
query_wait_timeout = 120
client_idle_timeout = 0

; DNS lookup timeout
dns_max_ttl = 15
dns_zone_check_period = 0

; Logging
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1
stats_period = 60

; Use SO_REUSEPORT for better multi-core performance
so_reuseport = 1

; Disable internal queries logging
verbose = 0

; Security
ignore_startup_parameters = extra_float_digits

; Connection verification
server_check_query = SELECT 1
server_check_delay = 30

; Replica lag configuration (optional, for read replicas)
; server_reset_query = DISCARD ALL
; server_reset_query_always = 0

; Application name tracking
application_name_add_host = 1
